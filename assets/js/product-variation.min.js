jQuery(function(c){c(document).ready(function(){c("select.variation_actions").select2({placeholder:wcv_frontend_product_variation.variation_actions_placeholder,allowClear:!0})});var i={},e=[];c(".wcv_variations",c("#wcv_variable_product_options")).sortable({items:".wcv_variation",cursor:"move",axis:"y",handle:".wcv-sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(){r.variation_row_indexes()}});var v=function(a,t,i,e){var e="attribute_"+a+"["+e+"]",n="variation_attribute "+a,o=c("<select></select>").attr("name",e).attr("class",n).data("taxonomy",a);return o.append('<option value="">'+wcv_frontend_product_variation.i18n_any_label+" "+i+"</option>"),c.each(t,function(a,t){o.append('<option value="'+a+'">'+t+"</option>")}),o},o=function(a,t,i){var e="default_attribute_"+a,n=a,o=c("<select></select>").attr("name",e).attr("class",n).data("current","").data("taxonomy",a);return o.append('<option value="">'+wcv_frontend_product_variation.i18n_any_label+" "+i+"</option>"),c.each(t,function(a,t){o.append('<option value="'+a+'">'+t+"</option>")}),o},s=function(a){if(0<a.length){var t=a.val(),i=c("option",a),e=[];i.each(function(){e.push({val:c(this).val(),text:c(this).text()})}),e.sort(function(a,t){return a.val>t.val?1:a.val==t.val?0:-1});for(var n=0,o=e.length;n<o;n++)c(i[n]).val(e[n].val).text(e[n].text);return a.val(t),a}},l=function(){var i=c("#wcv-variation-attributes").data("variation_attr");c(".wcv_variation").each(function(){var a=c(this).find("select.variation_attribute");a.sort(function(a,t){a=i[c(a).data("taxonomy")].position,t=i[c(t).data("taxonomy")].position;return t<a?1:a<t?-1:0}),a.detach().appendTo(c(this).find("span.variations_wrapper"))})},d=function(){var i=c("#wcv-variation-attributes").data("variation_attr"),a=c(".variation_default_values").find("select.default_attribute");a.sort(function(a,t){a=i[c(a).data("taxonomy")].position,t=i[c(t).data("taxonomy")].position;return t<a?1:a<t?-1:0}),a.detach().appendTo(".variation_default_values")},r={init:function(){c("#wcv_variable_product_options").on("change","input.variable_is_downloadable",this.variable_is_downloadable).on("change","input.variable_is_virtual",this.variable_is_virtual).on("change","input.variable_manage_stock",this.variable_manage_stock).on("click","button.notice-dismiss",this.notice_dismiss).on("click","h5 .wcv-sort",this.set_menu_order).on("reload",this.reload),c("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock").change(),c(document.body).on("wcv_variations_added",this.variation_added)},reload:function(){p.load_variations(1),this.variation_options},variable_is_downloadable:function(){c(this).closest(".wcv_variation").find(".show_if_variation_downloadable").hide(),c(this).is(":checked")&&c(this).closest(".wcv_variation").find(".show_if_variation_downloadable").show()},variable_is_virtual:function(){c(this).closest(".wcv_variation").find(".hide_if_variation_virtual").show(),c(this).is(":checked")&&c(this).closest(".wcv_variation").find(".hide_if_variation_virtual").hide()},variable_manage_stock:function(){c(this).closest(".wcv_variation").find(".show_if_variation_manage_stock").hide(),c(this).closest(".wcv_variation").find(".hide_if_variation_manage_stock").show(),c(this).is(":checked")&&(c(this).closest(".wcv_variation").find(".show_if_variation_manage_stock").show(),c(this).closest(".wcv_variation").find(".hide_if_variation_manage_stock").hide())},notice_dismiss:function(){c(this).closest("div.notice").remove()},update_input:function(a,t){return c("."+t).val(a),!1},adjust_price:function(a,r,_){return c(".wcv_variation ."+a).each(function(a,t){var i,e=0,n=parseFloat(c(this).attr("value")),o=0;(n.length<=0||isNaN(n))&&(n=0),((o=0<=r.indexOf("%")?(i=(e=parseFloat(r.replace("%","")))/100*parseFloat(n),"+"==_?parseFloat(n)+i:parseFloat(n)-i):(e=parseFloat(r),"+"==_?parseFloat(n)+e:parseFloat(n)-e))<0||isNaN(o))&&(o=0),c(this).attr("value",o)}),!1},variations_loaded:function(a,t){t=t||!1;var i=c("#wcv_variable_product_options");t||(c("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock",i).change(),c(".wcv_variation",i).each(function(a,t){var t=c(t),i=c(".sale_price_dates_from",t).val(),e=c(".sale_price_dates_to",t).val();""===i&&""===e||c("a.sale_schedule",t).click()})),c(".wcv_variations",i).sortable({items:".wcv_variation",cursor:"move",axis:"y",handle:".wcv-sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(){r.variation_row_indexes()}})},variation_added:function(a,t){1===t&&r.variations_loaded(null,!0)},set_menu_order:function(a){a.preventDefault();var a=c(this).closest(".wcv_variation").find(".variation_menu_order"),t=window.prompt(wcv_frontend_product_variation.i18n_enter_menu_order,a.val());null!=t&&(a.val(parseInt(t,10)).change(),p.save_variations())},variation_row_indexes:function(){var a=c("#wcv_variable_product_options").find(".wcv_variations"),a=parseInt(a.attr("data-page"),10),i=parseInt((a-1)*wcv_frontend_product_variation.variations_per_page,10);c(".wcv_variations .wcv_variation").each(function(a,t){c(".variation_menu_order",t).val(parseInt(c(t).index(".wcv_variations .wcv_variation"),10)+1+i).change()})}},u={setting_variation_image:null,init:function(){c("#wcv_variable_product_options").on("click",".upload_image_button",this.add_image)},add_image:function(a){var t,i,e=c(this),n=(e.attr("rel"),e.closest(".upload_image"));u.setting_variation_image=n,a.preventDefault(),e.is(".wcv_remove")?(c(".upload_image_id",u.setting_variation_image).val("").change(),u.setting_variation_image.find("img").eq(0).attr("src",wcv_frontend_product_variation.wcv_woocommerce_placeholder_img_src),u.setting_variation_image.find(".upload_image_button").removeClass("wcv_remove")):(void 0===t&&(t=wp.media({title:wcv_frontend_product_variation.i18n_choose_image,button:{text:wcv_frontend_product_variation.i18n_set_image},states:[new wp.media.controller.Library({title:wcv_frontend_product_variation.i18n_choose_image,filterable:"all"})]})).on("select",function(){i=t.state().get("selection").first().toJSON(),c.trim(i.url.length)<0||(attachment_url=(i.sizes.thumbnail||i).url,c(".upload_image_id",u.setting_variation_image).val(i.id).change(),u.setting_variation_image.find(".upload_image_button").addClass("wcv_remove"),u.setting_variation_image.find("img").eq(0).attr("src",attachment_url))}),t.open())},restore_wp_media_post_id:function(){wp.media.model.settings.post.id=c("#post_id").val()}},p={init:function(){c("#wcv_variable_product_options").on("click",".remove_variation",this.remove_variation),c(document.body).on("change","#wcv_variable_product_options .wcv_variations :input",this.input_changed).on("change",".variations-defaults select",this.defaults_changed),c(".wcv-metaboxes-wrapper").on("change","select.variation_grouped_actions",function(){var a=c(this).attr("id");p.do_variation_action(a)}),c(".wcv-metaboxes-wrapper").on("click","a.do_variation_action",function(){p.do_variation_action("variation_actions_single")}),c("a.variations").on("click",this.check_for_attribute_changes),c(document).ready(function(){var a=c("#wcv-variation-attributes").data("variation_attr");c.isEmptyObject(e)&&(e=c.extend({},a))})},check_for_attribute_changes:function(){var a,i=c("#wcv-variation-attributes").data("variation_attr");c.isEmptyObject(e)&&(e=c.extend({},i)),JSON.stringify(e)!=JSON.stringify(i)&&(JSON.stringify(e).length==JSON.stringify(i).length?(l(),d()):JSON.stringify(e).length>JSON.stringify(i).length?Object.keys(e).length==Object.keys(i).length?c.each(e,function(a,t){t=_.omit(t.values,Object.keys(i[a].values));c.isEmptyObject(t)||p.update_variations_ui(a,t,"term","-")}):(a=_.omit(e,Object.keys(i)),c.each(a,function(a,t){p.update_variations_ui(a,t,"attribute","-"),p.update_defaults_ui(a,t,"attribute","-")})):JSON.stringify(e).length<JSON.stringify(i).length&&(Object.keys(e).length==Object.keys(i).length?c.each(i,function(a,t){t=_.omit(t.values,Object.keys(e[a].values));c.isEmptyObject(t)||p.update_variations_ui(a,t,"term","+")}):(a=_.omit(i,Object.keys(e)),c.each(a,function(a,t){p.update_variations_ui(a,t,"attribute","+"),p.update_defaults_ui(a,t,"attribute","+")}))),e=jQuery.extend({},i)),jQuery.isEmptyObject(i)?(c(".variations-toolbar").hide(),c(".variations_notice").show()):(c(".variations-toolbar").show(),c(".variations_notice").hide()),p.check_total_variations()},update_variations_ui:function(e,n,o,r){c("#wcv-variation-attributes").data("variation_attr");p.block(),c(".wcv_variation").each(function(a,t){switch(o){case"attribute":var i;"-"==r?c(this).find("select."+e).remove():(i=v(e,n.values,n.label,a),c(this).find(".variation_title").append(i),l(),d());break;case"term":if("-"==r){let i=c(this).find("select."+e);c.each(n,function(a,t){i.find('[value="'+a+'"]').remove()})}else{let i=c(this).find("select."+e);c.each(n,function(a,t){i.append(c("<option></option>").attr("value",a).text(t))}),i=s(i)}}}),p.unblock()},update_defaults_ui:function(a,t,i,e){switch(i){case"attribute":var n;"-"==e?c(".variations-defaults").find("select."+a).remove():(n=o(a,t.values,t.label),c(".variation_default_values").append(n),l(),d());break;case"term":if("-"==e){let i=c(this).find("select."+a);c.each(t,function(a,t){i.find('[value="'+a+'"]').remove()})}else{let i=c(this).find("select."+a);c.each(t,function(a,t){i.append(c("<option></option>").attr("value",a).text(t))}),i=s(i)}}},check_total_variations:function(){return 0==c(".wcv_variation").length&&c(".variations-defaults").remove(),!1},block:function(){c("#wcv_variable_product_options").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){c("#wcv_variable_product_options").unblock()},load_default_attributes:function(){var a;0==c(".wcv_variation").length&&(a={action:"wcv_json_default_variation_attributes",attributes:c("#wcv-variation-attributes").data("variation_attr"),security:wcv_frontend_product_variation.wcv_add_variation_nonce},c.post(wcv_frontend_product_variation.ajax_url,a,function(a){a=c(a);c(".toolbar-variations-defaults").prepend(a),c(".toolbar-variations-defaults").show()}))},add_variation:function(){p.block();var a={action:"wcv_json_add_variation",loop:c(".wcv_variation").length,parent_data:i,attributes:c("#wcv-variation-attributes").data("variation_attr"),security:wcv_frontend_product_variation.wcv_add_variation_nonce};return c.post(wcv_frontend_product_variation.ajax_url,a,function(a){a=c(a);p.load_default_attributes(),c("#wcv_variable_product_options").find(".wcv_variations").prepend(a),c("#wcv_variable_product_options").trigger("wcv_variations_added",1),p.unblock()}),!1},remove_variation:function(){var a,t,i;if(window.confirm(wcv_frontend_product_variation.i18n_remove_variation))return t=(a=c(this).parent().parent().parent().parent()).attr("rel"),i=a.data("loop"),a.remove(),p.add_deleted_variation(t,i),n.update_variations_count(-1),p.check_total_variations(),!1},add_deleted_variation:function(a,t){var i,e;if(0!=a)return i=c("#wcv_deleted_variations").data("variations"),e={},jQuery.isEmptyObject(i)&&(i=[]),e.loop=t,e.id=a,i.push(e),c("#wcv_deleted_variations").data("variations",i),c("#wcv_deleted_variations").val(JSON.stringify(i)),!1},delete_all_variations:function(){return c(".wcv_variation").each(function(){var a=c(this).attr("rel"),t=c(this).data("loop");c(this).remove(),p.add_deleted_variation(a,t),n.update_variations_count(-1),p.check_total_variations()}),!1},link_all_variations:function(){var e,t,a;if(window.confirm(wcv_frontend_product_variation.i18n_link_all_variations))return p.block(),e=[],t=c(".wcv_variation").length,c(".wcv_variation").each(function(a,t){var i={};if(c(this).find(".variation_attribute").filter(function(){return""===this.value}).length)return!0;c(this).find(".variation_attribute").each(function(){i[c(this).attr("name").split("[")[0]]=c(this).val()}),e.push(i)}),a={action:"wcv_json_link_all_variations",parent_data:i,loop:c(".wcv_variation").length,attributes:c("#wcv-variation-attributes").data("variation_attr"),available_variations:e,security:wcv_frontend_product_variation.wcv_json_link_all_variations_nonce},c.post(wcv_frontend_product_variation.ajax_url,a,function(a){a=c(a),p.load_default_attributes(),c("#wcv_variable_product_options").find(".wcv_variations").prepend(a),a=parseInt(c(".wcv_variation").length)-parseInt(t);1==a?window.alert(a+" "+wcv_frontend_product_variation.i18n_variation_added):0==a||1<a?window.alert(a+" "+wcv_frontend_product_variation.i18n_variations_added):window.alert(wcv_frontend_product_variation.i18n_no_variations_added),n.update_variations_count(a),p.unblock()}),!1},input_changed:function(){c(this).closest(".wcv_variation").addClass("variation-needs-update"),c("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),c("#wcv_variable_product_options").trigger("wcv_variations_input_changed")},populate_parent:function(){i.title=c("#post_title").val(),i.sku=c("#_sku").val(),i.weight=c("#_weight").val(),i.length=c("#_length").val(),i.width=c("#_width").val(),i.height=c("#_height").val(),i.tax_status=c("#_tax_status").val()},defaults_changed:function(){c(this).closest("#wcv_variable_product_options").find(".wcv_variation:first").addClass("variation-needs-update"),c("#wcv_variable_product_options").trigger("wcv_variations_defaults_changed")},do_variation_action:function(a){var t,i,e=c("#"+a).val();if("-1"!=e)switch(p.populate_parent(),e){case"add_variation":return void p.add_variation();case"link_all_variations":return void p.link_all_variations();case"delete_all":window.confirm(wcv_frontend_product_variation.i18n_delete_all_variations)&&window.confirm(wcv_frontend_product_variation.i18n_last_warning)&&p.delete_all_variations();break;case"toggle_variable_enabled":case"toggle_variable_is_downloadable":case"toggle_variable_is_virtual":case"toggle_variable_manage_stock":var n=e.replace(/toggle_/,"");c("."+n).prop("checked",!c("."+n).prop("checked")),c("."+n).trigger("change");break;case"variable_regular_price_increase":case"variable_regular_price_decrease":case"variable_sale_price_increase":case"variable_sale_price_decrease":(t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value_fixed_or_percent))&&(n=-1<e.indexOf("increase")?"+":"-",i=-1<e.indexOf("increase")?e.substring(0,e.indexOf("_increase")):e.substring(0,e.indexOf("_decrease")),null!=t&&(t=0<=t.indexOf("%")?accounting.unformat(t.replace(/%/,""),wcv_frontend_product_variation.mon_decimal_point)+"%":accounting.unformat(t,wcv_frontend_product_variation.mon_decimal_point)),r.adjust_price(i,String(t),n));break;case"variable_regular_price":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),r.update_input(t,"variable_regular_price");break;case"variable_sale_price":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),r.update_input(t,"variable_sale_price");break;case"variable_stock":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),r.update_input(t,"variable_stock");break;case"variable_weight":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),r.update_input(t,"variable_weight");break;case"variable_length":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),r.update_input(t,"variable_length");break;case"variable_width":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),r.update_input(t,"variable_width");break;case"variable_height":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),r.update_input(t,"variable_height");break;case"variable_download_limit":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),r.update_input(t,"variable_download_limit");break;case"variable_download_expiry":t=window.prompt(wcv_frontend_product_variation.i18n_enter_a_value),r.update_input(t,"variable_download_expiry");break;case"variable_sale_schedule":date_from=window.prompt(wcv_frontend_product_variation.i18n_scheduled_sale_start),date_to=window.prompt(wcv_frontend_product_variation.i18n_scheduled_sale_end),null===date_from&&(date_from=!1),r.update_input(date_from,"sale_price_dates_from"),null===date_to&&(date_to=!1),r.update_input(date_to,"sale_price_dates_to");break;default:c("select#"+a).trigger(e),c("select#"+a).triggerHandler(e+"_ajax_data",{})}}},n={init:function(){c(document.body).on("wcv_variations_added",this.update_single_quantity)},update_variations_count:function(a){var t=c("#wcv_variable_product_options").find(".wcv_variations"),a=parseInt(t.attr("data-total"),10)+a,i=c(".variations-pagenav .displaying-num");return t.attr("data-total",a),1===a?i.text(wcv_frontend_product_variation.i18n_variation_count_single.replace("%qty%",a)):i.text(wcv_frontend_product_variation.i18n_variation_count_plural.replace("%qty%",a)),a},update_single_quantity:function(a,t){var i;1===t&&(i=c(".variations-pagenav"),n.update_variations_count(t),i.is(":hidden"))&&(c("option, optgroup",".variation_actions").show(),c(".variation_actions").val("add_variation"),c("#wcv_variable_product_options").find(".toolbar").show(),i.show(),c(".pagination-links",i).hide())}};c(".wcv_product_variations").on("click","h5.variation_title",function(a){c(a.target).filter(":input, option, .wcv-sort").length||c(this).parent().parent().parent().find(".wcv-metabox-content").stop().slideToggle()}).on("click",".expand_all",function(){return c(this).closest(".wcv-metaboxes-wrapper").find(".wcv-metabox > .wcv-metabox-content").show(),!1}).on("click",".close_all",function(){return c(this).closest(".wcv-metaboxes-wrapper").find(".wcv-metabox > .wcv-metabox-content").hide(),!1}),c(".wcv_product_variations").on("click",".downloadable_files a.insert",function(){return c(this).closest(".downloadable_files").find("tbody").append(c(this).data("row")),!1}),c(".wcv_product_variations").on("click",".downloadable_files a.delete",function(){return c(this).closest("tr").remove(),!1}),c(".wcv_product_variations").on("click",".sale_schedule",function(){return c(".sale_price_dates_fields").show(),c(this).hide(),c(".cancel_sale_schedule").show(),!1}),c(".wcv_product_variations").on("click",".cancel_sale_schedule",function(){return c(".sale_price_dates_fields").hide(),c(this).hide(),c(".sale_schedule").show(),!1}),r.init(),u.init(),p.init(),n.init()});